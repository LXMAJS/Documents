## 第四章、数组

> 为什么很多编程语言中，数组都是从 0 开始编号？

### 一、如何实现随机访问？

数组（Array），是一种线性表数据结构，它用一组连续的内存空间，来存储一组具有相同类型的数据。其中，线性表（Linear List），是数据排成一条线一样的结构。每个线性表的数据最多只有前和后两个方向。除了数组以外，链表、队列、栈 等也是线性表结构，而二叉树、堆、图 等都是非线性结构，因为在非线性表中，数据值见并不是简单的前后关系。

在初始化数组时，计算机会为数组分配连续的内存空间，当计算机需要访问某个元素时，会先通过选址公式计算出元素的内存地址：

```mathematica
a[i]_address = base_address + (i * data_type_size)
```

其中，``data_type_size`` 表示数据元素的大小，假设数组的元素是 int，那么 data_type_size 就是 4个字节。数组适合查找操作，排好序的数组使用二分查找法，其时间复杂度是 O(nlogn)，使用数组下标随机访问数组的时间复杂度是 O(1)。

### 二、低效的 "插入" 和 "删除"

为了使得上述的选址公式一直有效，在插入和删除数组元素时，必须将空位填补上，来保证数组在内存地址中的连续性。

假设数组的长度是n，往数组中第k个位置插入一个元素时，为了给新的元素腾地方，我们需要将 k~n 的元素都往后挪一位。如果在末尾插入，则不需要挪动元素，时间复杂度是 O(1)，如果在头部插入，则需要挪动整个数组，时间复杂度是 O(n)，按平均情况计算，其时间复杂度也是 O(n)。

如果数组元素是有序的，为了保证其顺序不变，在第k个位置插入时需要把挪动后面的数组后再执行插入。但如果是无序的数组，我们大可以将原来的第k个元素放到末尾，再直接插入新的元素就好。利用这种技巧，我们可以把插入的时间复杂度降低到 O(1)。

删除也是可以用类似的方法，如果我们要删除一些连续的元素，为了避免多次数据搬运，可以记录下删除的元素，在执行插入时可以替换原本被删除的元素即可，当没有更多的空间时，再触发执行一次真正的删除。JVM中的年轻代的标记清除算法，就是类似的处理。

### 三、访问越界

在C语言中，数组越界通常是不容易被发现的错误，举个例子：

``` C
int main(int argc, char* argv[]) {
  int i = 0;
  int arr[3] = 0;
  for(; i<=3; i++) {
    arr[i] = 0;
    printf("hello world\n");
  }
  return 0;
}
```

